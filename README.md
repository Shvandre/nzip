# Архиватор и разархиватор файлов

Проект архивации и разархивации файлов представляет собой консольное приложение для операционной системы GNU/Linux, написанное на языке C. Программа поддерживает различные степени сжатия. Для сжатия использована библиотека zlib.

## Зависимости

Программа зависит от следующих библиотек и пакетов:
- `zlib` — для архивации данных.
- `googletest` — для модульного тестирования.
- `glibc` — для парсинга аргументов командной строки
- `cppcheck` - для статического анализа кода
- `[OPTIONAL] lcov` — для генерации отчёта, из которого можно сделать веб-страницу для удобного просмотра отчёта. В случае отсутствия пакета информация будет выведена в текстовом виде с помощью `gcov`

## Опции командной строки
```
--bs=BLOCK_SIZE Поддерживается указание как в байтах так и в кило/мегабайтах через суффикс K/M по аналогии с dd.

-s Тихий режим. Сообщения об ошибках и некоторая другая информация не выводятся.

--compression=[1-9] Уровень сжатия

[archive.zip] Опционально можно указать имя выходного архива.
```

## Make targets

`make build` - Собрать решение (включает в себя 2 исполняймых файла - zip и unzip) \
`make build-san` - Аналогично предыдущему, но использовать санитайзеры \
`make zip/unzip/zip-san/unzip-san` - Собрать только 1 конкретный исполняймый файл \
`make test` - Собрать и запустить тесты. \
`make coverage` - Собрать и запустить тесты + подготовить отчёт о покрытии \
`make analyze` - Запустить статический анализатор для всех файлов в поддиректории Source
`make clean` - Очистить файлы созданные при каком-либо из предыдущих действий
## Реализованные защиты
Стандартными защитами, добавленными с помощью опций компилятора являются
```
-fstack-protector, -fstack-protector-strong, -fstack-protector-all *Для защиты от ошибки переполнения буфера

-fPIE, -pie *Для защиты от атак, основанных на предсказуемости адресов

-Wl,-z,noexecstack *Для защиты от атак, основанных на выполнении кода непосредственно на стеке
```
Самостоятельно добавленные защиты:

`Trap Flag check`- Проверка, установлен ли в данный момент TF. Иногда помогает обнаружить отладчик.

`PTRACE check` - Проверка, основанная на том, что система не позволяет подключить 2 дебаггера одновременно.

`TIME check` - Проверка, основанная на том, что функция не должна выполняться необоснованно долго, если конечно внутри не был установлен брейкпойинт.

## Векторы для улучшения защиты
Несомненно, самым важным аспектом, который стоит улучшить - является добавление защиты от статического анализа кода. Это может быть достингнуто, например, xor шифрованием строк и кода, который будет расшифровываться при заходе в функцию (это можно реализовать например зарегистрировав обработчик прерываний, который будет натыкаться на исключение в самом начале функции, после чего расшифровывать последующий код и аналогично в обратную сторону).

Для улучшения же динамической защиты стоит применить более интересные приёмы антиотладки, такие как проверка портов отладки, хуки API функций, виртуализация некоторых функций и подобное.

## Примечания
Для открытия графического отчёта о покрытии выполните
```bash
xdg-open coverage/index.html
```

Защита от запуска на виртуальной машине не была реализована, т.к. возможно, это поприпятствовало бы проверке этого задания)))

Решение тестировалось на Arch Linux с ядром 6.9.1 и компилятором gcc.
```bash
g++ --version
g++ (GCC) 14.1.1 20240507
```